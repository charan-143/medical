<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block styles %}{% endblock %}
</head>
<body>
    <div class="wrapper d-flex align-items-stretch">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">Dashboard</a>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto">
                        {% if current_user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <img src="{{ url_for('static', filename='img/avatar.png') }}" alt="Avatar" class="avatar">
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                <li><a class="dropdown-item" href="{{ url_for('auth.profile') }}">Profile</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Logout</a></li>
                            </ul>
                        </li>
                        {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.login') }}">Login</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.register') }}">Register</a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="content-wrapper">
            <!-- Sidebar -->
            {% if current_user.is_authenticated %}
            <nav id="sidebar">
            <ul class="list-unstyled components">
                <li class="{% if request.endpoint == 'dashboard.index' %}active{% endif %}">
                    <a href="{{ url_for('dashboard.index') }}"><i class="fas fa-home"></i> Home</a>
                </li>
                <li class="{% if request.endpoint == 'dashboard.overview' %}active{% endif %}">
                    <a href="{{ url_for('dashboard.overview') }}"><i class="fas fa-chart-line"></i> Overview</a>
                </li>
                <li class="{% if request.endpoint == 'dashboard.records' %}active{% endif %}">
                    <a href="{{ url_for('dashboard.records') }}"><i class="fas fa-folder"></i> Records</a>
                </li>
                <li class="{% if request.endpoint == 'chat.index' %}active{% endif %}">
                    <a href="{{ url_for('chat.index') }}"><i class="fas fa-robot"></i> AI Chat</a>
                </li>
                <li>
                    <a href="#uploadModal" data-bs-toggle="modal" data-bs-target="#uploadModal">
                        <i class="fas fa-upload"></i> Upload
                    </a>
                </li>
            </ul>
        </nav>
        {% endif %}
        
            <!-- Page Content -->
            <div id="content">
            <!-- Main content -->
            {% block content %}{% endblock %}
            </div>
        </div>

    </div>

    <!-- JavaScript Dependencies -->
    <!-- Upload Modal -->
    {% if current_user.is_authenticated %}
    <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadModalLabel">Upload Medical Records</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadForm" action="{{ url_for('dashboard.upload_json') }}" method="post" enctype="multipart/form-data">
                        <!-- Hidden field for folder ID, populated when folder is created -->
                        <input type="hidden" id="uploadFolderId" name="folder_id" value="">
                        <!-- CSRF token -->
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        <!-- Folder Name Input -->
                        <div class="mb-4">
                            <label class="form-label">Folder Name</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light">
                                    <i class="fas fa-folder-plus text-primary"></i>
                                </span>
                                <input type="text" class="form-control" id="newFolderName" name="folder_name" 
                                    placeholder="Enter folder name for these files" required>
                            </div>
                            <small class="text-muted mt-1">
                                A new folder with this name will be created and all files will be uploaded to it
                            </small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="description" class="form-label">Description (optional)</label>
                            <input type="text" class="form-control" id="description" name="description" placeholder="Brief description of the files">
                        </div>
                        <div class="mb-3">
                            <div id="dragDropArea" class="drag-drop-area">
                                <div class="drag-drop-message text-center p-5">
                                    <i class="fas fa-cloud-upload-alt fa-3x mb-3 text-primary"></i>
                                    <h5>Drag & Drop Files Here</h5>
                                    <p class="text-muted mb-3">or</p>
                                    <label for="recordFiles" class="btn btn-outline-primary">
                                        Browse Files
                                    </label>
                                    <input type="file" class="d-none" id="recordFiles" name="files[]" multiple>
                                    <p class="mt-2 small text-muted">Upload multiple files (max 10MB each)</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- File Preview Area -->
                        <div id="filePreviewContainer" class="file-preview-container mb-3 d-none">
                            <h6 class="mb-3">Files to Upload (<span id="fileCount">0</span>)</h6>
                            <div id="fileList" class="file-list"></div>
                            
                            <!-- Overall Progress Bar -->
                            <div class="mt-3 d-none" id="overallProgressContainer">
                                <label class="form-label d-flex justify-content-between">
                                    <span>Overall Progress</span>
                                    <span id="overallProgressPercent">0%</span>
                                </label>
                                <div class="progress">
                                    <div id="overallProgressBar" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Status Messages -->
                        <div id="uploadMessages" class="alert d-none mb-3"></div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" id="removeAllFiles" class="btn btn-outline-danger d-none">Remove All</button>
                            <button type="submit" id="uploadButton" class="btn btn-primary">Upload Files</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endif %}  <!-- Close the if block for upload modal -->

    <!-- JavaScript Dependencies -->
    {% block scripts %}
    <!-- External scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom JavaScript -->
    <!-- File Upload Script -->
    {% if current_user.is_authenticated %}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Basic modal setup and debugging
        const uploadModal = document.getElementById('uploadModal');
        if (uploadModal) {
            console.log('Modal element found, letting Bootstrap handle modal behavior');
            
            // Let Bootstrap's data-api handle modal functionality
            // Only add one show event listener for debugging
            uploadModal.addEventListener('show.bs.modal', function(event) {
                console.log('Modal is being shown');
                
                // Reset form when modal is opened
                document.getElementById('newFolderName').value = '';
                document.getElementById('uploadFolderId').value = '';
                document.getElementById('description').value = '';
                selectedFiles = [];
                updateFileList();
            });
        }
        
        
        // Elements
        const uploadForm = document.getElementById('uploadForm');
        const dragDropArea = document.getElementById('dragDropArea');
        const fileInput = document.getElementById('recordFiles');
        const filePreviewContainer = document.getElementById('filePreviewContainer');
        const fileList = document.getElementById('fileList');
        const fileCount = document.getElementById('fileCount');
        const uploadButton = document.getElementById('uploadButton');
        const removeAllBtn = document.getElementById('removeAllFiles');
        const uploadMessages = document.getElementById('uploadMessages');
        const overallProgressContainer = document.getElementById('overallProgressContainer');
        const overallProgressBar = document.getElementById('overallProgressBar');
        const overallProgressPercent = document.getElementById('overallProgressPercent');
        
        if (uploadButton) {
            console.log('Upload button found');
            // Force initial disable until files are selected
            uploadButton.disabled = true;
        } else {
            console.error('Upload button not found!');
        }
        // Variables for tracking files
        let selectedFiles = [];
        const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
        const ALLOWED_TYPES = [
            'image/jpeg', 'image/png', 'image/gif', 
            'application/pdf', 'application/msword', 
            'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            'application/vnd.ms-excel',
            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
        ];
        
        // Setup drag and drop events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dragDropArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dragDropArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dragDropArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dragDropArea.classList.add('highlight');
        }
        
        function unhighlight() {
            dragDropArea.classList.remove('highlight');
        }
        
        // Handle dropped files
        dragDropArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }
        
        // Handle files from file input
        fileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                console.log('Files selected via input:', this.files.length);
                handleFiles(this.files);
                
                // Force enable upload button if files are selected
                if (this.files.length > 0) {
                    uploadButton.disabled = false;
                }
            }
        });
        // Process selected files
        function handleFiles(files) {
            if (!files || !files.length) {
                console.log('No files to process');
                return;
            }
            
            console.log('Processing', files.length, 'files');
            
            // Add new files to our array
            Array.from(files).forEach(file => {
                // Check if file is valid
                const validationResult = validateFile(file);
                if (validationResult.valid) {
                    // Add to selected files if not already present (check by name for simplicity)
                    if (!selectedFiles.some(f => f.name === file.name)) {
                        console.log('Adding file:', file.name);
                        selectedFiles.push(file);
                    } else {
                        console.log('File already selected:', file.name);
                    }
                } else {
                    // Show error message for invalid file
                    showMessage(validationResult.message, 'warning');
                }
            });
            
            // Update the UI
            updateFileList();
            // Force update upload button state
            updateUploadButtonState();
            console.log('Total selected files:', selectedFiles.length);
        }
        // Validate file type and size
        function validateFile(file) {
            // Check file size
            if (file.size > MAX_FILE_SIZE) {
                return {
                    valid: false,
                    message: `File "${file.name}" exceeds the maximum size of 10MB`
                };
            }
            
            // Check file type (optional, based on allowed types)
            if (ALLOWED_TYPES.length > 0 && !ALLOWED_TYPES.includes(file.type)) {
                return {
                    valid: false,
                    message: `File "${file.name}" has an unsupported file type`
                };
            }
            
            return { valid: true };
        }
        
        // Update the file list display
        function updateFileList() {
            // Clear the current list
            fileList.innerHTML = '';
            fileCount.textContent = selectedFiles.length;
            
            console.log('Updating file list with', selectedFiles.length, 'files');
            
            // Show/hide elements based on file selection
            if (selectedFiles.length > 0) {
                console.log('Enabling upload button');
                filePreviewContainer.classList.remove('d-none');
                removeAllBtn.classList.remove('d-none');
                uploadButton.disabled = false;
            } else {
                console.log('Disabling upload button');
                filePreviewContainer.classList.add('d-none');
                removeAllBtn.classList.add('d-none');
                uploadButton.disabled = true;
            }
            
            // Add file items
            selectedFiles.forEach((file, index) => {
                console.log('Creating list item for file:', file.name);
                const fileItem = createFileItem(file, index);
                fileList.appendChild(fileItem);
            });
            
            // Force enable upload button if we have files
            if (selectedFiles.length > 0) {
                uploadButton.disabled = false;
            }
        }
        
        // Create a file item for the preview list
        function createFileItem(file, index) {
            const fileExt = file.name.split('.').pop().toLowerCase();
            
            // Create file item element
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item mb-2 p-2 border rounded d-flex align-items-center';
            
            // File icon based on type
            let iconClass = 'fa-file';
            if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExt)) {
                iconClass = 'fa-file-image';
            } else if (fileExt === 'pdf') {
                iconClass = 'fa-file-pdf';
            } else if (['doc', 'docx'].includes(fileExt)) {
                iconClass = 'fa-file-word';
            } else if (['xls', 'xlsx'].includes(fileExt)) {
                iconClass = 'fa-file-excel';
            }
            
            // Calculate human-readable file size
            const fileSize = formatFileSize(file.size);
            
            // File preview (thumbnail for images)
            let previewElement = '';
            if (file.type.startsWith('image/')) {
                previewElement = `
                    <div class="file-thumbnail me-2">
                        <img src="${URL.createObjectURL(file)}" alt="${file.name}" class="img-thumbnail" style="width: 40px; height: 40px; object-fit: cover;">
                    </div>
                `;
            } else {
                previewElement = `
                    <div class="file-icon me-2">
                        <i class="fas ${iconClass} fa-2x text-secondary"></i>
                    </div>
                `;
            }
            
            // Build the file item HTML
            fileItem.innerHTML = `
                ${previewElement}
                <div class="file-info flex-grow-1">
                    <div class="file-name text-truncate">${file.name}</div>
                    <div class="file-size small text-muted">${fileSize}</div>
                </div>
                <div class="file-progress d-none">
                    <div class="progress" style="width: 60px; height: 6px;">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                </div>
                <button type="button" class="btn-close ms-2 remove-file" data-index="${index}" aria-label="Remove file"></button>
            `;
            
            // Add event listener for remove button
            fileItem.querySelector('.remove-file').addEventListener('click', function() {
                removeFile(this.getAttribute('data-index'));
            });
            
            return fileItem;
        }
        
        // Remove a file from the selection
        function removeFile(index) {
            console.log('Removing file at index:', index);
            selectedFiles.splice(index, 1);
            updateFileList();
            updateUploadButtonState();
        }
        // Format file size to human-readable format
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Remove all files
        removeAllBtn.addEventListener('click', function() {
            selectedFiles = [];
            updateFileList();
            showMessage('All files removed', 'info');
        });
        
        // Force check upload button state initially
        uploadButton.disabled = selectedFiles.length === 0;
        
        // Make sure upload button is enabled when files are selected
        function updateUploadButtonState() {
            console.log('Updating button state, files count:', selectedFiles.length);
            uploadButton.disabled = selectedFiles.length === 0;
        }
        
        // Show status message
        function showMessage(message, type = 'info') {
            uploadMessages.textContent = message;
            uploadMessages.className = `alert alert-${type}`;
            uploadMessages.classList.remove('d-none');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                uploadMessages.classList.add('d-none');
            }, 5000);
        }
        // Handle form submission with AJAX
        uploadForm.addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Upload form submitted');
            
            if (selectedFiles.length === 0) {
                showMessage('Please select at least one file to upload', 'warning');
                return;
            }
            
            // First check for folder name
            const folderName = document.getElementById('newFolderName').value.trim();
            
            if (!folderName) {
                showMessage('Please enter a folder name', 'warning');
                return;
            }
            
            // Disable upload button and show progress
            uploadButton.disabled = true;
            uploadButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Uploading...';
            
            // Create the folder first, then upload files
            createFolderThenUpload(folderName);
        });
        
        // Function to create folder and then upload files
        async function createFolderThenUpload(folderName) {
            try {
                showMessage('Creating folder...', 'info');
                
                // Create folder via AJAX
                const folderFormData = new FormData();
                folderFormData.append('folder_name', folderName);
                folderFormData.append('parent_id', ''); // Root level
                folderFormData.append('csrf_token', document.querySelector('input[name="csrf_token"]').value);
                
                const response = await fetch('{{ url_for("dashboard.create_folder_json") }}', {
                    method: 'POST',
                    body: folderFormData,
                    headers: {
                        'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to create folder: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || 'Failed to create folder');
                }
                
                // Update folder ID and proceed with upload
                const folderId = data.folder_id;
                document.getElementById('uploadFolderId').value = folderId;
                
                showMessage(`Folder "${folderName}" created. Uploading files...`, 'info');
                
                // Now upload the files to the newly created folder
                uploadFilesToFolder(folderId);
                
            } catch (error) {
                uploadButton.disabled = false;
                uploadButton.innerHTML = 'Upload Files';
                showMessage(`Error: ${error.message}`, 'danger');
                console.error('Error creating folder:', error);
            }
        }
        
        // Function to upload files to the folder
        function uploadFilesToFolder(folderId) {
            // Prepare FormData for file upload
            const formData = new FormData();
            
            // Add form fields
            formData.append('folder_id', folderId);
            formData.append('description', document.getElementById('description').value);
            formData.append('csrf_token', document.querySelector('input[name="csrf_token"]').value);
            
            // Add each file to the FormData
            selectedFiles.forEach(file => {
                formData.append('files[]', file);
            });
            
            // Show progress indicators
            overallProgressContainer.classList.remove('d-none');
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                const progressDiv = item.querySelector('.file-progress');
                if (progressDiv) progressDiv.classList.remove('d-none');
            });
            
            // Create and configure AJAX request
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '{{ url_for("dashboard.upload_json") }}', true);
            
            // Add CSRF token header
            const csrfToken = document.querySelector('input[name="csrf_token"]').value;
            xhr.setRequestHeader('X-CSRFToken', csrfToken);
            
            // Log information for debugging
            console.log('Uploading files to folder ID:', folderId);
            
            // Track upload progress
            xhr.upload.addEventListener('progress', function(e) {
                if (e.lengthComputable) {
                    const percentComplete = Math.round((e.loaded / e.total) * 100);
                    
                    // Update overall progress
                    overallProgressBar.style.width = percentComplete + '%';
                    overallProgressBar.setAttribute('aria-valuenow', percentComplete);
                    overallProgressPercent.textContent = percentComplete + '%';
                    
                    // Update individual file progress bars evenly
                    fileItems.forEach(item => {
                        const progressBar = item.querySelector('.progress-bar');
                        if (progressBar) progressBar.style.width = percentComplete + '%';
                    });
                }
            });
            
            // Handle response
            xhr.onload = function() {
                uploadButton.disabled = false;
                uploadButton.innerHTML = 'Upload Files';
                
                if (xhr.status === 200) {
                    try {
                        const response = JSON.parse(xhr.responseText);
                        if (response.success) {
                            // Show success message
                            showMessage(response.message, 'success');
                            
                            // Clear files
                            selectedFiles = [];
                            updateFileList();
                            
                            // If we're in a folder view, refresh the page after a delay
                            setTimeout(() => {
                                if (window.location.href.includes('dashboard/records')) {
                                    window.location.reload();
                                }
                            }, 2000);
                            
                            // Close the modal after a delay
                            setTimeout(() => {
                                const uploadModal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
                                if (uploadModal) {
                                    uploadModal.hide();
                                }
                            }, 1500);
                        } else {
                            showMessage('Upload failed: ' + response.message, 'danger');
                        }
                    } catch (e) {
                        showMessage('Error processing response: ' + e.message, 'danger');
                    }
                } else {
                    // Handle HTTP error
                    handleUploadError(xhr);
                }
            };
            
            // Handle network errors
            xhr.onerror = function() {
                uploadButton.disabled = false;
                uploadButton.innerHTML = 'Upload Files';
                overallProgressContainer.classList.add('d-none');
                showMessage('Network error occurred during upload', 'danger');
                console.error('Network error during file upload');
            };
            
            // Add timeout handler
            xhr.ontimeout = function() {
                uploadButton.disabled = false;
                uploadButton.innerHTML = 'Upload Files';
                overallProgressContainer.classList.add('d-none');
                showMessage('Upload request timed out. Try again with smaller files or a better connection.', 'danger');
                console.error('Upload request timed out');
                
                // Reset progress UI
                fileItems.forEach(item => {
                    const progressDiv = item.querySelector('.file-progress');
                    if (progressDiv) progressDiv.classList.add('d-none');
                });
            };
            
            // Send the request
            xhr.send(formData);
        }
        
        // For debugging - show more detailed error messages
        function handleUploadError(xhr) {
            let errorMessage = 'Upload failed';
            
            try {
                const response = JSON.parse(xhr.responseText);
                errorMessage = response.message || 'Unknown error';
            } catch (e) {
                if (xhr.status === 413) {
                    errorMessage = 'File too large. Maximum size is 10MB per file.';
                } else if (xhr.status === 500) {
                    errorMessage = 'Server error. Please try again later.';
                } else if (xhr.status === 400) {
                    errorMessage = 'Invalid request. Please check your files.';
                } else {
                    errorMessage = `Error (${xhr.status}): ${xhr.statusText || 'Unknown error'}`;
                }
            }
            
            // Display error message
            showMessage(errorMessage, 'danger');
            console.error('Upload error:', errorMessage);
            
            // Reset progress UI
            overallProgressContainer.classList.add('d-none');
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                const progressDiv = item.querySelector('.file-progress');
                if (progressDiv) progressDiv.classList.add('d-none');
            });
        }
        }
        
        const style = document.createElement('style');
        style.textContent = `
            /* Modal debugging styles */
            /* CSS Variable Definitions */
            :root {
                --border-color: #dee2e6;
                --primary-color: #4361ee;
                --primary-rgb: 67, 97, 238;
                --bg-light: #f9fafb;
                --bg-hover: #f8f9fa;
                --font-weight-medium: 500;
                --border-radius-lg: 0.5rem;
                --border-radius-md: 0.375rem;
                --transition-normal: 0.3s ease;
                --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
                --space-2: 0.5rem;
                --space-3: 0.75rem;
            }
            
            #newFolderName {
                border-left: none;
                font-weight: var(--font-weight-medium);
            }
            .input-group-text {
                border-right: none;
            }
            .drag-drop-area {
                border: 2px dashed var(--border-color);
                border-radius: var(--border-radius-lg);
                background-color: var(--bg-light);
                transition: all var(--transition-normal);
                cursor: pointer;
            }
            .drag-drop-area.highlight {
                border-color: var(--primary-color);
                background-color: rgba(67, 97, 238, 0.05);
                transform: scale(1.01);
                box-shadow: var(--shadow-md);
            }
            .file-preview-container {
                max-height: 300px;
                overflow-y: auto;
                padding: var(--space-3);
                border-radius: var(--border-radius-md);
                background-color: var(--bg-light);
                border: 1px solid var(--border-color);
            }
            .file-item {
                transition: all var(--transition-normal);
            }
            .file-item:hover {
                background-color: var(--bg-hover);
                transform: translateY(-2px);
            }
            .file-thumbnail img {
                border-radius: var(--border-radius-md);
                box-shadow: var(--shadow-sm);
                transition: all var(--transition-normal);
            }
            .file-item:hover .file-thumbnail img {
                transform: scale(1.05);
            }
            .folder-path {
                background-color: var(--bg-light);
                border-radius: var(--border-radius-md);
                padding: var(--space-2) var(--space-3);
                border: 1px solid var(--border-color);
            }
        `;
        document.head.appendChild(style);
        
        // Log initialization completed
        console.log('Upload form initialization completed');
    });
    </script>
    {% endif %}
    {% endblock scripts %}
</body>
</html>
